<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta media="(prefers-color-scheme: light)" content=#222 name=theme-color><meta media="(prefers-color-scheme: dark)" content=#222 name=theme-color><meta content="Hexo 7.0.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/uploads/favicon.png rel=icon sizes=32x32 type=image/png><link href=/uploads/favicon.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><meta content=OjZus6o2Mdpe6amcrVvFu7aVReMoe-zG4QnNHK_pRqU name=google-site-verification><link href=/css/main.css rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css integrity=sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><link crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css integrity=sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc= rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/green/pace-theme-minimal.css rel=stylesheet><script crossorigin=anonymous integrity=sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0= src=https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js></script><script class=next-config data-name=main type=application/json>{"hostname":"www.430074.xyz","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"fold":{"enable":true,"height":200},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta content="1、前言自从 cdn.jsdelivr.net 被 qiang 了之后，很多网站都无法正常访问。目前比较受欢迎的解决方法是用其镜像网址代替，比如 gcore.jsdelivr.net， cf.jsdelivr.net 和 fastly.jsdelivr.net。其中 fastly.jsdelivr.net 由于大陆解析的服务器在日本所以延迟较低，但是丢包较大，而 gcore.jsdelivr.ne" name=description><meta content=blog property=og:type><meta content="Cloudflare workers 反代 jsdeliver 并套上 CDN" property=og:title><meta content=https://www.430074.xyz/posts/workers-jsdeliver.html property=og:url><meta content="Jarmo's Blog" property=og:site_name><meta content="1、前言自从 cdn.jsdelivr.net 被 qiang 了之后，很多网站都无法正常访问。目前比较受欢迎的解决方法是用其镜像网址代替，比如 gcore.jsdelivr.net， cf.jsdelivr.net 和 fastly.jsdelivr.net。其中 fastly.jsdelivr.net 由于大陆解析的服务器在日本所以延迟较低，但是丢包较大，而 gcore.jsdelivr.ne" property=og:description><meta content=zh_CN property=og:locale><meta content=2022-05-22T02:44:43.000Z property=article:published_time><meta content=2023-12-15T17:16:33.396Z property=article:modified_time><meta content="Jarmo Hu" property=article:author><meta content=编程 property=article:tag><meta content=网络 property=article:tag><meta content=建站 property=article:tag><meta content=summary name=twitter:card><link href=https://www.430074.xyz/posts/workers-jsdeliver.html rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.430074.xyz/posts/workers-jsdeliver.html","path":"/posts/workers-jsdeliver.html","title":"Cloudflare workers 反代 jsdeliver 并套上 CDN"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Cloudflare workers 反代 jsdeliver 并套上 CDN | Jarmo's Blog</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><link title="Jarmo's Blog" href=/atom.xml rel=alternate type=application/atom+xml><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>Jarmo's Blog</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>人生总要做点什么吧</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>关于</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签<span class=badge>9</span></a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类<span class=badge>7</span></a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档<span class=badge>9</span></a><li class="menu-item menu-item-sitemap"><a href=/sitemap.xml rel=section><i class="fa fa-sitemap fa-fw"></i>站点地图</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#1%E3%80%81%E5%89%8D%E8%A8%80><span class=nav-number>1.</span> <span class=nav-text>1、前言</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#2%E3%80%81%E4%BB%A3%E7%A0%81><span class=nav-number>2.</span> <span class=nav-text>2、代码</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3%E3%80%81%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B><span class=nav-number>3.</span> <span class=nav-text>3、使用教程</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAcloudflare-workers><span class=nav-number>3.1.</span> <span class=nav-text>3.1 创建一个 cloudflare workers</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-2-%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0%E3%80%82><span class=nav-number>3.2.</span> <span class=nav-text>3.2 修改参数。</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-3-%E8%8E%B7%E5%BE%97%E5%8A%A0%E5%AF%86%E8%AF%B7%E6%B1%82%E7%BD%91%E5%9D%80><span class=nav-number>3.3.</span> <span class=nav-text>3.3 获得加密请求网址</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>Jarmo Hu<div class=site-description itemprop=description>意义是自己赋予的</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>9</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>7</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>9</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <span title="GitHub → https://github.com/jarmohu" class=exturl data-url=aHR0cHM6Ly9naXRodWIuY29tL2phcm1vaHU=><i class="fab fa-github fa-fw"></i>GitHub</span> </span><span class=links-of-author-item> <span title="E-Mail → mailto:jarmohu@qq.com" class=exturl data-url=bWFpbHRvOmphcm1vaHVAcXEuY29t><i class="fa fa-envelope fa-fw"></i>E-Mail</span> </span></div><div class="cc-license animated" itemprop=license><span class="exturl cc-opacity" data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://www.430074.xyz/posts/workers-jsdeliver.html itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/images/avatar.gif itemprop=image> <meta content="Jarmo Hu" itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="Jarmo's Blog" itemprop=name> <meta content=意义是自己赋予的 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="Cloudflare workers 反代 jsdeliver 并套上 CDN | Jarmo's Blog" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>Cloudflare workers 反代 jsdeliver 并套上 CDN</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2022-05-22 10:44:43" datetime=2022-05-22T10:44:43+08:00>2022-05-22</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-12-16 01:16:33" datetime=2023-12-16T01:16:33+08:00 itemprop=dateModified>2023-12-16</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E7%BC%96%E7%A8%8B%EF%BC%8C%E5%BB%BA%E7%AB%99/ itemprop=url rel=index><span itemprop=name>编程，建站</span></a> </span> </span><span class=post-meta-item id=busuanzi_container_page_pv title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span id=busuanzi_value_page_pv></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>813</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>3 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><h2 id=1、前言><a class=headerlink href=#1、前言 title=1、前言></a>1、前言</h2><p>自从 cdn.jsdelivr.net 被 qiang 了之后，很多网站都无法正常访问。目前比较受欢迎的解决方法是用其镜像网址代替，比如 gcore.jsdelivr.net， cf.jsdelivr.net 和 fastly.jsdelivr.net。其中 fastly.jsdelivr.net 由于大陆解析的服务器在日本所以延迟较低，但是丢包较大，而 gcore.jsdelivr.net 和 cf.jsdelivr.net 延迟和丢包都不理想。并且，由于某些原因，这些镜像服务并不能保证以后一直可以使用。<p>本文介绍了一种使用 cloudflare workers 反代 cdn.jsdelivr.net 的方法。workers 提供每天 10w 次的免费访问额度，对于一些小站非常好用，若是套上 CDN，则通过缓存可以大大减少请求数。同时本文提供的方案可以防止跨站和对 url 进行加密，从而避免自己的服务被人滥用。本人非专业程序员，js 和正则都是现学的，如果有改进方式，非常欢迎指导。</p><span id=more></span><h2 id=2、代码><a class=headerlink href=#2、代码 title=2、代码></a>2、代码</h2><pre class="line-numbers language-javascript" data-language=javascript><code class=language-javascript><span class="token comment">// 允许的 CORS 来源</span>
<span class="token keyword">const</span> <span class="token constant">ALLOWED_REFERER</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/localhost(:\d*)?\/.*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/([\w-]+\.)*w3schools\.com(:\d*)?\/.*$</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 是否允许所有无 Referer 请求</span>
<span class="token keyword">const</span> <span class="token constant">ALLOW_NO_ORIGIN</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">//输入你的密码，密码加在path后面做SHA-1运算</span>
<span class="token keyword">const</span> <span class="token constant">MYSECRET</span> <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span>


<span class="token keyword">function</span> <span class="token function">validateReferer</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> referer <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Referer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>referer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> el <span class="token keyword">of</span> <span class="token constant">ALLOWED_REFERER</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>referer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token constant">ALLOW_NO_ORIGIN</span><span class="token punctuation">;</span> <span class="token comment">// 是否拒绝所有无 Referer 请求</span>
<span class="token punctuation">}</span>


<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> acceptType <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Accept'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> hash_request <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> path_real <span class="token operator">=</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>hash_request<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  url<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"cdn.jsdelivr.net"</span><span class="token punctuation">;</span>
  url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> path_real<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">validatePath</span><span class="token punctuation">(</span>hash_request<span class="token punctuation">,</span> path_real<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Error Hash'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">403</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">validateReferer</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Blocked Host'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">403</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">validatePath</span><span class="token punctuation">(</span><span class="token parameter">hash_request<span class="token punctuation">,</span> path_real</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>path_real <span class="token operator">+</span> <span class="token constant">MYSECRET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> myDigest <span class="token operator">=</span> <span class="token keyword">await</span> crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'SHA-1'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> hashArray <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>myDigest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> hashHex <span class="token operator">=</span> hashArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=></span> b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>hashHex <span class="token operator">==</span> hash_request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> 
<span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">handle</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden=true class=line-numbers-rows><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id=3、使用教程><a class=headerlink href=#3、使用教程 title=3、使用教程></a>3、使用教程</h2><h3 id=3-1-创建一个cloudflare-workers><a title="3.1 创建一个cloudflare workers" class=headerlink href=#3-1-创建一个cloudflare-workers></a>3.1 创建一个 cloudflare workers</h3><p>复制粘贴以上代码，建议绑定自己的域名，此处可参考网上其他教程。比如：<br> <span class=exturl data-url=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzU4NjA2ODM0L2FydGljbGUvZGV0YWlscy8xMjQ2NzAyMTg=>CloudFlare Workers 设置使用自定义域名_一曲横笛的博客 - CSDN 博客_cloudflare workers 绑定自定义域名<i class="fa fa-external-link-alt"></i></span><br><span class=exturl data-url=aHR0cHM6Ly93d3cuY3h5empkLmNvbS9hcnRpY2xlL3FxXzIyOTAzNTMxLzEwOTU0NDczMA==>CloudFlare 的 Worker 免费部署服务_Jum 的博客 - 程序员宅基地_cloudflare worker - 程序员宅基地<i class="fa fa-external-link-alt"></i></span><h3 id=3-2-修改参数。><a title="3.2 修改参数。" class=headerlink href=#3-2-修改参数。></a>3.2 修改参数。</h3><p>1、修改 ALLOWED_REFERER 常量，里面包含了可以使用本服务的域名列表。按照模板，修改成自己的域名。同时 ALLOW_NO_ORIGIN = true 是表示允许无 referer 访问本服务，比如直接浏览器打开。若是对 Referer 有疑问，可参考：<span class=exturl data-url=aHR0cHM6Ly93d3cucnVhbnlpZmVuZy5jb20vYmxvZy8yMDE5LzA2L2h0dHAtcmVmZXJlci5odG1s>HTTP Referer 教程 - 阮一峰的网络日志<i class="fa fa-external-link-alt"></i></span>。<p>2、修改密码 MYSECRET，这里的密码是用来加密网址的，因为 Referer 可以伪造，所以为了避免他人用你的服务干自己的事情，所以需要密码进行加密。<h3 id=3-3-获得加密请求网址><a title="3.3 获得加密请求网址" class=headerlink href=#3-3-获得加密请求网址></a>3.3 获得加密请求网址</h3><p>1、假设 workers 绑定的域名是 w3schools.com ，密码是 123456 ，想要反代的网址是<span class=exturl data-url=aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9qcXVlcnlAMy4yLjEvZGlzdC9qcXVlcnkubWluLmpz> https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js<i class="fa fa-external-link-alt"></i></span> 。<p>2、获得带加密的明文，为 url.path + 密码，如上则是 /npm/<span class=exturl data-url=bWFpbHRvOiYjMTA2OyYjMTEzOyYjMTE3OyYjeDY1OyYjeDcyOyYjMTIxOyYjeDQwOyYjeDMzOyYjeDJlOyYjNTA7JiN4MmU7JiN4MzE7>jquery@3.2.1<i class="fa fa-external-link-alt"></i></span>/dist/jquery.min.js123456 。获得该字符串的 SHA-1 编码，比如可以通过这个网站：<span class=exturl data-url=aHR0cDovL3d3dy5tZXRvb2xzLmluZm8vY29kZS9jMjIuaHRtbA==>SHA1 在线加密、校验工具 - ME2 在线工具<i class="fa fa-external-link-alt"></i></span> 。得到密文 371388c8eafe02c8876f67abe1d170b920218881。<p>3、生成新的请求网址：你的域名 + / 密文 + 原 url.path。如上文则是 <span class=exturl data-url=aHR0cHM6Ly93M3NjaG9vbHMuY29tLzM3MTM4OGM4ZWFmZTAyYzg4NzZmNjdhYmUxZDE3MGI5MjAyMTg4ODEvbnBtL2pxdWVyeUAzLjIuMS9kaXN0L2pxdWVyeS5taW4uanM=>https://w3schools.com/371388c8eafe02c8876f67abe1d170b920218881/npm/jquery@3.2.1/dist/jquery.min.js<i class="fa fa-external-link-alt"></i></span> 。然后在网站中替换为该地址即可。</div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>本文作者： </strong>Jarmo Hu<li class=post-copyright-link><strong>本文链接：</strong> <a title="Cloudflare workers 反代 jsdeliver 并套上 CDN" href=https://www.430074.xyz/posts/workers-jsdeliver.html>https://www.430074.xyz/posts/workers-jsdeliver.html</a><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class=exturl data-url=aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a class=social-link href=/atom.xml target=_blank> <span class=icon> <i class="fa fa-rss"></i> </span> <span class=label>RSS</span> </a></div></div></div><div class=post-tags><a href=/tags/%E7%BC%96%E7%A8%8B/ rel=tag><i class="fa fa-tag"></i> 编程</a><a href=/tags/%E7%BD%91%E7%BB%9C/ rel=tag><i class="fa fa-tag"></i> 网络</a><a href=/tags/%E5%BB%BA%E7%AB%99/ rel=tag><i class="fa fa-tag"></i> 建站</a></div><div class=post-nav><div class=post-nav-item><a href=/posts/wgtheory.html rel=prev title=导波光学学习笔记（开坑了）> <i class="fa fa-angle-left"></i> 导波光学学习笔记（开坑了） </a></div><div class=post-nav-item><a title="读书笔记 ——《社会性动物》思维导图" href=/posts/shehuixingdongwu.html rel=next> 读书笔记 ——《社会性动物》思维导图 <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=beian><span class=exturl data-url=aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==>鄂ICP备 20002600号-2 </span><img alt src=https://beian.mps.gov.cn/favicon.ico><span class=exturl data-url=aHR0cHM6Ly9iZWlhbi5tcHMuZ292LmNuLyMvcXVlcnkvd2ViU2VhcmNoP2NvZGU9NDIwMTExMDIwMDU0MDk=>鄂公网安备 42011102005409号 </span></div><div class=copyright>© <span itemprop=copyrightYear>2023</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>Jarmo Hu</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>8k</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>28 分钟</span> </span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=总访客量> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=总访问量> <span id=busuanzi_value_site_pv></span> </span> </span></div><div class=powered-by>由 <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url=aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==>NexT.Gemini</span> 强力驱动</div></div></footer><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script alpha=0.6 size=300 src=https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js zindex=-1></script><script crossorigin=anonymous integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script crossorigin=anonymous integrity=sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao= src=https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js></script><script crossorigin=anonymous integrity=sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo= src=https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js></script><script crossorigin=anonymous integrity=sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc= src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js></script><script crossorigin=anonymous integrity=sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I= src=https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script crossorigin=anonymous integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=/js/third-party/search/local-search.js></script><script src=/js/third-party/fancybox.js></script><script src=/js/third-party/pace.js></script><script async data-pjax src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=enableMath type=application/json>false</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src=/js/third-party/math/mathjax.js></script>